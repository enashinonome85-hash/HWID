<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Verificaci√≥n de HWID y UUID (Firebase)</title>

<style>
:root { --bg-overlay: rgba(255,255,255,0.15); --panel-bg: rgba(255,255,255,0.85); --text-color:#111; }
body.dark { --bg-overlay: rgba(0,0,0,0.45); --panel-bg: rgba(0,0,0,0.75); --text-color:#fff; }
body { font-family: Arial, sans-serif; margin:40px; color:var(--text-color); text-align:center;
    background-image:url('20240731_073957.jpg'); background-size:cover; background-position:center; background-attachment:fixed; }
h1,h2 { text-shadow:2px 2px 6px rgba(0,0,0,.4); }
input, select { padding:10px; width:280px; font-size:16px; border-radius:8px; border:none; outline:none;
    background:var(--panel-bg); color:var(--text-color); }
button { padding:10px 18px; font-size:16px; margin-top:10px; cursor:pointer; border-radius:8px; border:none;
    background:#2980b9; color:white; font-weight:bold; transition:.2s; }
button:hover { background:#3498db; }
#resultado { margin-top:20px; font-size:20px; font-weight:bold; min-height:24px; }
#resultadoAgregar { margin-top:12px; font-size:18px; font-weight:bold; min-height:24px; }
.caja-flotante { width:90%; max-width:450px; background:var(--panel-bg); padding:20px; border-radius:15px;
    position:fixed; top:50%; left:50%; transform:translate(-50%,-50%) scale(0.7); display:none; color:var(--text-color);
    backdrop-filter: blur(6px); box-shadow:0px 0px 20px #000; opacity:0; transition:opacity .3s ease, transform .3s ease; z-index:9999; }
.caja-flotante.visible { display:block; opacity:1; transform:translate(-50%,-50%) scale(1); }
.closeBtn { background:#c0392b; border:none; padding:6px 14px; border-radius:6px; color:white; font-weight:bold;
    cursor:pointer; position:absolute; top:12px; right:12px; }
.lista-scroll { overflow-y:auto; max-height:300px; margin-top:10px; text-align:left; }
.tabla { display:flex; flex-direction:column; width:100%; }
.fila { display:flex; }
.columna { flex:1; min-width:150px; padding:6px; border-bottom:1px solid rgba(0,0,0,0.2); word-break:break-word; text-align:center; }
.encabezado .columna { font-weight:bold; background:var(--bg-overlay); }
.delBtn { background-color:red; color:white; border:none; padding:4px 8px; font-size:12px; cursor:pointer; border-radius:4px; display:block; margin:5px auto 0; }
.bienvenida { position:fixed; top:50%; left:50%; transform:translate(-50%,-50%) scale(0.6); background:var(--panel-bg);
    color:var(--text-color); padding:30px 35px; border-radius:16px; backdrop-filter:blur(12px); box-shadow:0px 0px 30px rgba(0,0,0,0.5);
    text-align:center; width:350px; max-width:90%; opacity:0; pointer-events:none; transition:opacity .45s ease, transform .45s ease; z-index:9999; }
.bienvenida.visible { opacity:1; transform:translate(-50%,-50%) scale(1); pointer-events:auto; }
#fondoBienvenida { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.55); backdrop-filter:blur(4px); z-index:9998; opacity:0; pointer-events:none; transition:opacity .4s ease; }
#fondoBienvenida.visible { opacity:1; pointer-events:auto; }
#switchContainer { position:fixed; top:20px; right:20px; display:flex; flex-direction:column; align-items:center; z-index:9999; }
#switchText { margin-bottom:6px; font-weight:bold; color:var(--text-color); }
#switchTema { width:60px; height:30px; background:var(--panel-bg); border-radius:50px; cursor:pointer; box-shadow:0 3px 10px rgba(0,0,0,0.4); display:flex; align-items:center; padding:3px; transition:background .3s ease, transform .3s ease; }
#switchTema .toggle { width:24px; height:24px; background:var(--text-color); border-radius:50%; transition:transform .3s ease, background .3s ease; box-shadow:0 2px 5px rgba(0,0,0,0.3); }
body.dark #switchTema .toggle { transform:translateX(30px); }
#footerText { position:fixed; bottom:20px; left:20px; background:var(--bg-overlay); padding:8px 12px; border-radius:8px; color:var(--text-color); font-weight:bold; font-size:14px; z-index:999; }
#importExportContainer { display:flex; justify-content:center; gap:15px; margin-top:10px; }
</style>
</head>
<body>

<!-- Interruptor -->
<div id="switchContainer">
    <div id="switchText">Modo Claro</div>
    <div id="switchTema" onclick="toggleTema()"><div class="toggle"></div></div>
</div>

<!-- Bienvenida -->
<div id="fondoBienvenida"></div>
<div id="bienvenida" class="bienvenida">
    <h2>¬°Bienvenido!</h2>
    <p>Gracias por usar el verificador de HWID / UUID.</p>
    <button onclick="cerrarBienvenida()">Comenzar</button>
</div>

<h1>Verificaci√≥n de HWID y UUID</h1>

<h2>üîé Verificar HWID / UUID</h2>
<input id="codigoVerificar" placeholder="Ingresa HWID o UUID" />
<br /><br />
<label for="columnaSeleccion">Selecciona columna para verificar:</label>
<select id="columnaSeleccion"></select>
<button onclick="verificar()">Verificar</button>
<div id="resultado"></div>

<hr />

<h2>üìå Agregar HWID / UUID</h2>

<input id="inputAgregarDirecto" placeholder="Ingresa HWID/UUID" />
<br /><br />
<label for="columnaAgregarDirecto">Selecciona columna para agregar:</label>
<select id="columnaAgregarDirecto"></select>
<br /><br />
<button onclick="agregarDirecto()">Agregar</button>

<div id="resultadoAgregar"></div>

<br />
<button onclick="abrirAgregar()">Agregar con caja flotante</button>

<div id="cajaAgregar" class="caja-flotante">
    <button class="closeBtn" onclick="cerrarAgregar()">X</button>
    <h3>Agregar HWID / UUID</h3>
    <input id="inputAgregar" placeholder="Ingresa HWID/UUID" />
    <br /><br />
    <label for="columnaAgregar">Selecciona columna:</label>
    <select id="columnaAgregar"></select>
    <br /><br />
    <button onclick="agregarAHWID()">Agregar</button>
</div>

<br />
<button id="toggleBtn" onclick="toggleLista()">Mostrar lista</button>
<button onclick="toggleHistorial()">Historial de verificaciones</button>

<div id="listaFlotante" class="caja-flotante">
    <button class="closeBtn" onclick="toggleLista()">X</button>
    <div id="lista" class="lista-scroll">
        <div class="tabla">
            <div class="fila encabezado" id="encabezadoColumnas"></div>
            <div id="filasHWID"></div>
        </div>
    </div>
    <div id="importExportContainer">
        <button onclick="exportarLista()">Exportar</button>
        <button onclick="importarLista()">Importar</button>
    </div>
</div>

<div id="historialFlotante" class="caja-flotante">
    <button class="closeBtn" onclick="toggleHistorial()">X</button>
    <h3>Historial de Verificaciones</h3>

    <button onclick="borrarHistorial()" style="background:#c0392b; margin-bottom:10px;">
        Borrar historial
    </button>

    <div id="historialContenido" class="lista-scroll" style="font-size:14px;"></div>
</div>

<div id="footerText">Verificaci√≥n de HWID/UUID torneo de mujeres</div>

<!-- Firebase SDK (compat) -->
<!-- REEMPLAZA EL firebaseConfig ABAJO por tu propia configuraci√≥n desde Firebase Console -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
/* ==========================
   CONFIGURACI√ìN
   ========================== */
const CONTRASENA = "torneo2025";

/* === OPCIONAL: usar Firebase (si config no est√° puesta, caer√° a localStorage) === */
const USE_FIREBASE = true; // cambia a false si no quieres usar Firestore por ahora

// REEMPLAZA ESTE OBJETO CON LA CONFIG DEL SDK WEB DE TU PROYECTO FIREBASE
const firebaseConfig = {
    apiKey: "TU_API_KEY",
    authDomain: "TU_AUTH_DOMAIN",
    projectId: "TU_PROJECT_ID",
    // ... los demas campos (storageBucket, messagingSenderId, appId) opcionales aqu√≠
};

let db = null;
if (USE_FIREBASE) {
    try {
        firebase.initializeApp(firebaseConfig);
        db = firebase.firestore();
        console.log("Firebase inicializado");
    } catch (e) {
        console.warn("Error inicializando Firebase:", e);
        db = null;
    }
}

/* ==========================
   DATOS LOCALES Y NOMBRES
   ========================== */
let codigos = JSON.parse(localStorage.getItem("codigosGuardados")) || [];
let historial = JSON.parse(localStorage.getItem("historialVerificacion")) || [];

const nombresColumnas = [
    "STELLARA","DINGOS GHOST",":STEAMDANCE:","4LOV","LAS MALCRIADAS","ANGELS APOCALYPTIC",
    "Las Oh√±o","Woosh Girls","Blackyard Queens","BELLATRIX","PANDORA'S HORDE","Super Stars",
    "The show girls","D' la rose","Las Quecas","HOA","Los Trabas","Infinity Girls"
];

function escapeHtml(text) {
    if (typeof text !== "string") return text;
    return text.replace(/[&<>"']/g, c => ({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[c]));
}

/* ==========================
   SELECTORES Y ENCABEZADO
   ========================== */
const selector = document.getElementById("columnaSeleccion");
const selectorAgregar = document.getElementById("columnaAgregar");
const selectorAgregarDirecto = document.getElementById("columnaAgregarDirecto");

nombresColumnas.forEach((nombre,index)=>{
    [selector,selectorAgregar,selectorAgregarDirecto].forEach(sel=>{
        const opt=document.createElement("option");
        opt.value=index; opt.textContent=nombre;
        sel.appendChild(opt);
    });
});

function crearEncabezado(){
    const encabezadoDiv=document.getElementById("encabezadoColumnas");
    encabezadoDiv.innerHTML="";
    nombresColumnas.forEach(nombre=>{
        const col=document.createElement("div");
        col.className="columna";
        col.innerHTML=escapeHtml(nombre);
        encabezadoDiv.appendChild(col);
    });
}
crearEncabezado();

/* ==========================
   SINCRONIZACI√ìN FIRESTORE
   ========================== */

async function loadCodigosFromCloud() {
    if(!db) return;
    try {
        const doc = await db.collection("app_data").doc("codigos").get();
        if (doc.exists) {
            const data = doc.data();
            if (Array.isArray(data.lista)) {
                codigos = data.lista;
                localStorage.setItem("codigosGuardados", JSON.stringify(codigos));
                actualizarLista();
                console.log("Codigos cargados desde Firestore");
            }
        }
    } catch (e) { console.warn("Error cargando codigos desde Firestore:", e); }
}

async function syncCodigosToCloud() {
    if(!db) return;
    try {
        await db.collection("app_data").doc("codigos").set({ lista: codigos });
        console.log("Codigos sincronizados a Firestore");
    } catch (e) { console.warn("Error sincronizando codigos:", e); }
}

async function addHistorialEntryToCloud(entry) {
    if(!db) return;
    try {
        await db.collection("historial").add(entry);
        console.log("Entrada de historial guardada en Firestore");
    } catch (e) { console.warn("Error guardando historial en Firestore:", e); }
}

async function clearHistorialCloud() {
    if(!db) return;
    try {
        // Firestore no tiene 'delete collection' simple en cliente; eliminamos documentos uno a uno.
        const snap = await db.collection("historial").get();
        const batch = db.batch();
        snap.forEach(doc => batch.delete(doc.ref));
        await batch.commit();
        console.log("Historial borrado en Firestore");
    } catch (e) { console.warn("Error borrando historial en Firestore:", e); }
}

/* Al iniciar: tratar de cargar desde cloud */
if (USE_FIREBASE && db) {
    loadCodigosFromCloud();
    // tambi√©n podr√≠amos cargar historial si lo necesitas; dejamos historial local como espejo,
    // porque para mostrar historial traemos los docs en actualizarHistorial() si hay db.
}

/* ==========================
   ACTUALIZAR UI (LISTA)
   ========================== */
function actualizarLista(){
    const filasDiv=document.getElementById("filasHWID");
    filasDiv.innerHTML="";
    if(codigos.length===0){
        filasDiv.innerHTML=`<div class="fila"><div class="columna">No hay HWID/UUID guardados.</div></div>`;
        return;
    }
    const totalCols=nombresColumnas.length;
    const totalFilas=Math.ceil(codigos.length/totalCols);
    for(let i=0;i<totalFilas;i++){
        const fila=document.createElement("div"); fila.className="fila";
        for(let j=0;j<totalCols;j++){
            const index=i*totalCols+j;
            const codigo=codigos[index]||"";
            const boton=codigo?`<button class="delBtn" onclick="eliminarCodigo(${index})">Eliminar</button>`:"";
            const col=document.createElement("div");
            col.className="columna";
            col.innerHTML=escapeHtml(codigo)+boton;
            fila.appendChild(col);
        }
        filasDiv.appendChild(fila);
    }
}

/* ==========================
   AGREGAR / ELIMINAR
   ========================== */
function existeHWID(valor){ return codigos.includes(valor); }

function agregarEnColumna(valor,colIndex){
    const resultadoAgregarDiv=document.getElementById("resultadoAgregar");
    resultadoAgregarDiv.textContent=""; resultadoAgregarDiv.style.color="";
    if(existeHWID(valor)){
        resultadoAgregarDiv.textContent="‚úò Este HWID/UUID ya est√° registrado.";
        resultadoAgregarDiv.style.color="red";
        return false;
    }
    const numColumnas=nombresColumnas.length;
    const totalFilas=Math.ceil(codigos.length/numColumnas);
    let nuevaLista=codigos.slice();
    let insertIndex=-1;
    for(let fila=0;fila<totalFilas;fila++){
        const idx=fila*numColumnas+colIndex;
        if(idx>=nuevaLista.length||nuevaLista[idx]===""||nuevaLista[idx]===undefined){
            insertIndex=idx; break;
        }
    }
    if(insertIndex===-1) insertIndex=totalFilas*numColumnas+colIndex;
    while(nuevaLista.length<insertIndex) nuevaLista.push("");
    nuevaLista[insertIndex]=valor;
    codigos=nuevaLista;
    localStorage.setItem("codigosGuardados",JSON.stringify(codigos));
    actualizarLista();
    resultadoAgregarDiv.textContent="‚úî HWID/UUID agregado correctamente.";
    resultadoAgregarDiv.style.color="lime";

    // sincronizar a Firestore (si est√° activo)
    syncCodigosToCloud();
    return true;
}

function agregarAHWID(){
    const valor=document.getElementById("inputAgregar").value.trim();
    const colIndex=parseInt(document.getElementById("columnaAgregar").value);
    if(!valor){ alert("HWID/UUID vac√≠o"); return; }
    if(agregarEnColumna(valor,colIndex)){ document.getElementById("inputAgregar").value=""; cerrarAgregar(); }
}

function agregarDirecto(){
    const valor=document.getElementById("inputAgregarDirecto").value.trim();
    const colIndex=parseInt(document.getElementById("columnaAgregarDirecto").value);
    if(!valor){ alert("HWID/UUID vac√≠o"); return; }
    if(agregarEnColumna(valor,colIndex)) document.getElementById("inputAgregarDirecto").value="";
}

function eliminarCodigo(i){
    const input=prompt("Ingrese la contrase√±a para eliminar este HWID/UUID:");
    if(input===null) return;
    if(input!==CONTRASENA){ alert("Contrase√±a incorrecta"); return; }
    codigos[i]="";
    localStorage.setItem("codigosGuardados",JSON.stringify(codigos));
    actualizarLista();
    syncCodigosToCloud();
}

/* ==========================
   LISTA VISIBLE
   ========================== */
let listaVisible=false;
function toggleLista(){
    listaVisible=!listaVisible;
    document.getElementById("listaFlotante").classList.toggle("visible",listaVisible);
    document.getElementById("toggleBtn").textContent=listaVisible?"Lista abierta":"Mostrar lista";
}

/* ==========================
   VERIFICACI√ìN + HISTORIAL
   ========================== */
async function verificar(){
    const c=document.getElementById("codigoVerificar").value.trim();
    const r=document.getElementById("resultado");
    const colIndex=parseInt(document.getElementById("columnaSeleccion").value);

    const colHWIDs=codigos.filter((_,i)=>i%nombresColumnas.length===colIndex);
    const encontrado=colHWIDs.includes(c);

    if(encontrado){
        r.textContent="‚úî Correcto: HWID/UUID verificado en "+nombresColumnas[colIndex];
        r.style.color="lime";
    } else {
        r.textContent="‚úò Incorrecto: no se encontr√≥ en "+nombresColumnas[colIndex];
        r.style.color="red";
    }

    const entry = {
        codigo: c,
        columna: nombresColumnas[colIndex],
        resultado: encontrado ? "Correcto" : "Incorrecto",
        fecha: new Date().toISOString()
    };

    // guardar local y en cloud
    historial.push(entry);
    localStorage.setItem("historialVerificacion", JSON.stringify(historial));
    actualizarHistorial();

    // enviar a Firestore (document por entrada)
    if (db) {
        try {
            await addHistorialEntryToCloud(entry);
        } catch(e) {
            console.warn("No se pudo guardar historial en Firestore:", e);
        }
    }
}

/* ==========================
   HISTORIAL UI
   ========================== */
let historialVisible=false;
function toggleHistorial(){
    historialVisible=!historialVisible;
    document.getElementById("historialFlotante").classList.toggle("visible",historialVisible);
    actualizarHistorial();
}

async function actualizarHistorial(){
    const cont=document.getElementById("historialContenido");
    cont.innerHTML="";

    // Si tenemos Firestore y queremos cargar desde la colecci√≥n
    if (db) {
        try {
            const snap = await db.collection("historial").orderBy("fecha","desc").limit(200).get();
            if (!snap.empty) {
                snap.forEach(doc => {
                    const item = doc.data();
                    cont.innerHTML += `
                        <div style="border-bottom:1px solid #999; padding:6px;">
                            <b>HWID/UUID:</b> ${escapeHtml(item.codigo)}<br>
                            <b>Columna:</b> ${escapeHtml(item.columna)}<br>
                            <b>Resultado:</b> ${escapeHtml(item.resultado)}<br>
                            <b>Fecha:</b> ${new Date(item.fecha).toLocaleString()}
                        </div>
                    `;
                });
                return;
            }
        } catch(e) {
            console.warn("No se pudo leer historial desde Firestore, cayendo a local:", e);
        }
    }

    // Si no hay db o hubo error, mostramos historial local
    if (historial.length === 0) {
        cont.innerHTML = "<p style='color:gray'>No hay historial todav√≠a.</p>";
        return;
    }
    // mostrar local invertido (m√°s reciente arriba)
    historial.slice().reverse().forEach(item=>{
        cont.innerHTML += `
            <div style="border-bottom:1px solid #999; padding:6px;">
                <b>HWID/UUID:</b> ${escapeHtml(item.codigo)}<br>
                <b>Columna:</b> ${escapeHtml(item.columna)}<br>
                <b>Resultado:</b> ${escapeHtml(item.resultado)}<br>
                <b>Fecha:</b> ${new Date(item.fecha).toLocaleString()}
            </div>
        `;
    });
}

/* ==========================
   BORRAR HISTORIAL (local + cloud)
   ========================== */
async function borrarHistorial(){
    const input = prompt("Ingresa la contrase√±a para borrar el historial:");
    if(input===null) return;
    if(input!==CONTRASENA){ alert("Contrase√±a incorrecta"); return; }

    // borrar local
    historial = [];
    localStorage.setItem("historialVerificacion", JSON.stringify(historial));
    await actualizarHistorial();

    // borrar cloud (si posible)
    if (db) {
        try {
            await clearHistorialCloud();
        } catch(e) {
            console.warn("No fue posible borrar historial en Firestore:", e);
        }
    }
    alert("Historial borrado correctamente.");
}

/* ==========================
   IMPORT / EXPORT
   ========================== */
function exportarLista(){
    const dataStr="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(codigos));
    const dlAnchor=document.createElement("a");
    dlAnchor.setAttribute("href",dataStr);
    dlAnchor.setAttribute("download","lista_hwid_uuid.json");
    document.body.appendChild(dlAnchor);
    dlAnchor.click();
    dlAnchor.remove();
}

function importarLista(){
    const input=document.createElement("input");
    input.type="file"; input.accept=".json";
    input.onchange=e=>{
        const file=e.target.files[0];
        const reader=new FileReader();
        reader.onload=ev=>{
            try{
                const data=JSON.parse(ev.target.result);
                if(Array.isArray(data)){
                    codigos=data;
                    localStorage.setItem("codigosGuardados",JSON.stringify(codigos));
                    actualizarLista();
                    // sincronizar al cloud
                    syncCodigosToCloud();
                    alert("Importaci√≥n exitosa!");
                } else alert("Archivo inv√°lido");
            }catch(err){ alert("Error al leer archivo"); }
        }
        reader.readAsText(file);
    }
    input.click();
}

/* ==========================
   TEMA / BIENVENIDA / ONLOAD
   ========================== */
function toggleTema(){
    document.body.classList.toggle("dark");
    document.getElementById("switchText").textContent=document.body.classList.contains("dark")?"Modo Oscuro":"Modo Claro";
}

function mostrarBienvenida(){
    if(localStorage.getItem("bienvenidaVISTA")==="1") return;
    const b=document.getElementById("bienvenida");
    const f=document.getElementById("fondoBienvenida");
    b.style.display="block"; f.style.display="block";
    setTimeout(()=>{ b.classList.add("visible"); f.classList.add("visible"); },50);
}
function cerrarBienvenida(){
    const b=document.getElementById("bienvenida");
    const f=document.getElementById("fondoBienvenida");
    b.classList.remove("visible"); f.classList.remove("visible");
    localStorage.setItem("bienvenidaVISTA","1");
    setTimeout(()=>{ b.style.display="none"; f.style.display="none"; },450);
}
document.getElementById("fondoBienvenida").onclick=cerrarBienvenida;

/* cargar UI inicial */
actualizarLista();
actualizarHistorial();
window.onload=mostrarBienvenida;

</script>
</body>
</html>
